<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShopBuddy</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary': '#10b981',       /* Emerald 500 */
            'primary-dark': '#059669',  /* Emerald 600 */
            'page-bg': '#0f172a',       /* Slate 900 */
            'surface': '#1e293b',       /* Slate 800 */
            'chat-bg': '#f8fafc',       /* Light background for chat popup */
            'bubble-bot': '#e2e8f0',    /* Slate 200 */
            'bubble-user': '#10b981',   /* Emerald 500 */
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <!-- Custom CSS -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    /* Floating Icon */
    .chatbot-icon {
      position: fixed;
      bottom: 30px;
      right: 30px;
      cursor: pointer;
      z-index: 1000;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .chatbot-icon:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }

    /* Chat Popup */
    .chat-popup {
      position: fixed;
      bottom: 100px;
      right: 30px;
      width: 380px;
      max-height: 550px;
      display: none;
      z-index: 1001;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      border-radius: 12px;
      overflow: hidden;
      background-color: #f8fafc; /* ✅ lighter popup */
      color: #1e293b;
    }

    .msg_card_body {
      overflow-y: auto;
      height: 400px;
      padding: 1rem;
      background-color: #f1f5f9; /* subtle contrast inside */
    }

    /* Bot message */
    .msg_cotainer {
      background-color: #e2e8f0;
      color: #1e293b;
      border-radius: 10px 10px 10px 0;
      padding: 10px 14px;
      max-width: 80%;
      margin-top: 5px;
    }

    /* User message */
    .msg_cotainer_send {
      background-color: #10b981;
      color: #fff;
      border-radius: 10px 10px 0 10px;
      padding: 10px 14px;
      max-width: 80%;
      margin-top: 5px;
    }

    .msg_time, .msg_time_send {
      font-size: 0.65rem;
      opacity: 0.8;
      margin-top: 4px;
      display: block;
      text-align: right;
    }
    .msg_time { color: #64748b; }
    .msg_time_send { color: #d1fae5; }

    .user_img_msg {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }

    @media (max-width: 640px) {
      .chat-popup {
        width: 90%;
        right: 5%;
        bottom: 80px;
      }
    }
  </style>
</head>
<body class="bg-page-bg antialiased">

  <!-- Hero -->
  <div class="flex flex-col items-center justify-center text-center p-8 h-screen bg-surface">
    <div class="max-w-4xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
      <h1 class="text-5xl font-extrabold text-white sm:text-6xl mb-4">
        Welcome to <span class="text-primary">ShopBuddy</span>
      </h1>
      <p class="mt-3 text-xl text-slate-300">
        Your AI-Powered Shopping Assistant. Get instant answers on prices, stock, and reviews.
      </p>
      <div class="mt-8">
        <button id="scrollToChat" class="px-6 py-3 rounded-full bg-primary text-page-bg hover:bg-primary-dark transition">
          Start Chatting Now
        </button>
      </div>
    </div>
  </div>

  <!-- Floating Icon -->
  <div class="chatbot-icon" id="openChat">
    <button class="w-16 h-16 bg-primary rounded-full flex items-center justify-center shadow-2xl hover:bg-primary-dark">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2" class="text-page-bg">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
    </button>
  </div>

  <!-- Chat Popup -->
  <div class="chat-popup" id="chatPopup">
    <div class="flex flex-col h-full">
      <div class="p-4 bg-primary flex items-center justify-between">
        <div class="flex items-center">
          <img src="https://placehold.co/40x40/10b981/0f172a?text=SB" class="rounded-full mr-3 border-2 border-page-bg" alt="ShopBuddy Avatar">
          <div>
            <span class="font-semibold text-page-bg">ShopBuddy</span>
            <small class="block text-emerald-900">Online | Ready to help</small>
          </div>
        </div>
        <button class="text-page-bg" id="closeChat">
          ✕
        </button>
      </div>

      <!-- Messages -->
      <div id="messageFormeight" class="msg_card_body">
        <div class="flex justify-start mb-2">
          <img src="https://placehold.co/32x32/10b981/0f172a?text=SB" class="user_img_msg mr-2">
          <div class="msg_cotainer">
            Hello! I'm ShopBuddy, your smart shopping companion. How can I help you today?
            <span class="msg_time">10:00 AM</span>
          </div>
        </div>
      </div>

      <!-- Input -->
      <div class="p-3 border-t border-slate-300">
        <form id="messageArea" class="flex items-center">
          <input type="text" id="text" name="msg" placeholder="Type your query..." class="flex-grow p-2 border bg-white text-black rounded-l-lg">
          <button type="submit" id="send" class="p-2.5 bg-primary text-white rounded-r-lg hover:bg-primary-dark">
            ➤
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script>
    const BOT_AVATAR_URL = "https://placehold.co/32x32/10b981/0f172a?text=SB";
    const USER_AVATAR_URL = "https://placehold.co/32x32/94a3b8/1e293b?text=U";

    function appendMessage(html) {
      $("#messageFormeight").append(html);
      $("#messageFormeight").scrollTop($("#messageFormeight")[0].scrollHeight);
    }

    $(document).ready(function() {
      $("#openChat, #scrollToChat").click(() => $("#chatPopup").fadeIn());
      $("#closeChat").click(() => $("#chatPopup").fadeOut());

      $("#messageArea").on("submit", function(e) {
        e.preventDefault();
        const rawText = $("#text").val().trim();
        if (!rawText) return;

        const date = new Date();
        const str_time = `${date.getHours()}:${String(date.getMinutes()).padStart(2,'0')}`;

        const userHtml = `
          <div class="flex justify-end mb-2">
            <div class="msg_cotainer_send">${rawText}<span class="msg_time_send">${str_time}</span></div>
            <img src="${USER_AVATAR_URL}" class="user_img_msg ml-2">
          </div>`;
        $("#text").val("");
        appendMessage(userHtml);

        $.ajax({
          data: { msg: rawText },
          type: "POST",
          url: "/get",
        }).done(function(data) {
          const botHtml = `
            <div class="flex justify-start mb-2">
              <img src="${BOT_AVATAR_URL}" class="user_img_msg mr-2">
              <div class="msg_cotainer">${data}<span class="msg_time">${str_time}</span></div>
            </div>`;
          appendMessage(botHtml);
        }).fail(function() {
          appendMessage(`<div class="msg_cotainer" style="background:#fee2e2;color:#991b1b;">⚠️ Error: server not reachable</div>`);
        });
      });
    });
  </script>

  <!-- Footer -->
  <footer class="mt-auto py-3 bg-gray-900 text-slate-400 text-center">
    <p class="text-sm">© 2025 ShopBuddy Systems</p>
  </footer>
</body>
</html>
